<UserControl x:Class="MES.Views.Machines"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:MES.Helpers"
             Height="700" Width="1200">

    <UserControl.Resources>
        <!-- Converters -->
        <local:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <local:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>

        <!-- Status Color Converter -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>

        <!-- Status Colors -->
        <SolidColorBrush x:Key="IdleColor" Color="#CCCCCC"/>
        <SolidColorBrush x:Key="RunningColor" Color="#4CAF50"/>
        <SolidColorBrush x:Key="MaintenanceColor" Color="#FF9800"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#F44336"/>

        <!-- Button Styles -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10" Background="#F5F5F5">
            <TextBlock Text="Machines Management" FontSize="24" FontWeight="Bold" Margin="10"/>
            <TextBlock Text="MES System" FontSize="16" VerticalAlignment="Center" Foreground="Gray" Margin="20,0"/>
        </StackPanel>

        <!-- Toolbar -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="10">
            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="10,0"/>
            <Button Content="ðŸ”„ Complete maintenance" Command="{Binding UpdateStatusCommand}" Style="{StaticResource ActionButtonStyle}" Background="#FF9800" Foreground="White"/>
            <Button Content="ðŸ”§ Maintenance" Command="{Binding AddMaintenanceCommand}" Style="{StaticResource ActionButtonStyle}" Background="#9C27B0" Foreground="White"/>
            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="10,0"/>
            <Button Content="ðŸ”„ Refresh" Command="{Binding RefreshCommand}" Style="{StaticResource ActionButtonStyle}" Background="#00BCD4" Foreground="White"/>
        </StackPanel>

       

        <!-- Main Content -->
        <Grid Grid.Row="2" Margin="-6,11,6,11" Grid.RowSpan="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="167*"/>
                <ColumnDefinition Width="73*"/>
            </Grid.ColumnDefinitions>

            <!-- Machines DataGrid -->
            <DataGrid Grid.Column="0" 
                      ItemsSource="{Binding Machines}" 
                      SelectedItem="{Binding SelectedMachine}"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      GridLinesVisibility="All"
                      HeadersVisibility="All"
                      AlternatingRowBackground="#F9F9F9"
                      Margin="10,0,10,20">

                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Status" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Ellipse Style="{StaticResource StatusIndicatorStyle}"
                                         Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="ID" Binding="{Binding MachineId}" Width="60"/>
                    <DataGridTextColumn Header="Machine Name" Binding="{Binding MachineName}" Width="200"/>
                    <DataGridTextColumn Header="Machine Type" Binding="{Binding MachineType}" Width="150"/>
                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                    <DataGridTextColumn Header="Last Maintenance" Binding="{Binding LastMaintenanceDate, StringFormat=dd/MM/yyyy}" Width="120"/>
                    <DataGridTextColumn Header="Created Date" Binding="{Binding CreatedDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Machine Details Panel -->
            <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Margin="10,10,10,10">
                <StackPanel>
                    <TextBlock Text="Machine Details" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                    <!-- Machine Info -->
                    <GroupBox Header="Machine Info" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <TextBlock Text="{Binding SelectedMachine.MachineName, StringFormat='Machine Name: {0}'}" Margin="0,5"/>
                            <TextBlock Text="{Binding SelectedMachine.MachineType, StringFormat='Machine Type: {0}'}" Margin="0,5"/>
                            <TextBlock Text="{Binding SelectedMachine.Status, StringFormat='Status: {0}'}" Margin="0,5"/>
                            <TextBlock Text="{Binding SelectedMachine.LastMaintenanceDate, StringFormat='Last Maintenance: {0:dd/MM/yyyy}'}" Margin="0,5"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Current Order -->

                    <!-- Maintenance History -->
                    <GroupBox Header="Maintenance History" Margin="0,0,0,20">
                        <StackPanel Margin="10">
                            <TextBlock Text="No maintenance history" 
                                       Foreground="Gray" 
                                       TextWrapping="Wrap"
                                       Visibility="{Binding SelectedMachine.MaintenanceHistory.Count, Converter={StaticResource CountToVisibilityConverter}}"/>

                            <ItemsControl ItemsSource="{Binding SelectedMachine.MaintenanceHistory}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="LightGray" BorderThickness="1" Margin="0,5" Padding="10">
                                            <StackPanel>
                                                <TextBlock Text="{Binding MaintenanceDate, StringFormat='Date: {0:dd/MM/yyyy}'}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Description}" TextWrapping="Wrap"/>
                                                <TextBlock Text="{Binding Technician}" TextWrapping="Wrap"/>                                        
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Background="#F0F0F0">
            <StatusBarItem>
                <TextBlock Text="{Binding Machines.Count, StringFormat='Total: {0} Machines'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl> 